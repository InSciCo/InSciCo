---
layout: docpage
menu0: mdd
menu1: tutorials
menu2: vsmac
---

<div class=lz-r-content>
    <h3>Building the PetStore Solution</h3>
    <p>In this lesson step we will build the initial PetStore solution using the .NET LazyStack tool configured as a Visual Studio Tool.</p>

    <p><strong>This tutorial assumes you are using the Mac Visual Studio IDE.</strong></p>
    <h4>2.1 Create PetStore solution</h4>
    <ol>
        <li><a href="/mdd/install/mdd_install_visualstudio_mac.html" {{> newtab}}>Configure your developer workstation with Visual Studio IDE for Mac.</a></li>
        <li>Launch Visual Studio.</li>
        <li>Click on New project. The "Choose a template for your new project" dialog appears.</li>
        <li>Click on "Web and Console &rightarrow; App. </li>
        <li>Select API under the ASP.NET Core and click the Next button. The first "Configure your new API" page appears.</li>
        <li>Select .NET6 for the target framework, No Authentication and Configure for HTTPS.</li>
        <li>Click the Next button. The next "Configure your new API" page appears.</li>
        <li>Enter "PetStore" as the Project Name.</li>
        <li>Keep "PetStore" as the Solution Name.</li>
        <li>Edit the Location to point to the LazyStackTutorial folder.</li>
        <li>Check the checkbox "Create a project directory within the solution directory."</li>
        <li>Click on the Create button. A solution with your PetStore WebApi project is created.</li>
        <li>Open the project file and replace its content with the following:<br>
            To edit a project file, right click on the project name in the solution explorer and select "Edit Project File" from 
            the context menu.
            <pre><code class="language-csharp"><?xml version="1.0" encoding="utf-8"?>
&lt;Project Sdk="Microsoft.NET.Sdk.Web">
    &lt;PropertyGroup>
    &lt;TargetFramework>net6.0&lt;/TargetFramework>
    &lt;Product>LazyStackWebApi Template&lt;/Product>
    &lt;Description>A WebApi template compatible with LazyStack for local debugging of lambda functions&lt;/Description>
    &lt;/PropertyGroup>
    &lt;ItemGroup>
    &lt;PackageReference Include="AWSSDK.Extensions.NETCore.Setup" Version="3.7.2" />
    &lt;PackageReference Include="Swashbuckle.AspNetCore" Version="6.2.3" />
    &lt;/ItemGroup>
&lt;/Project></code></pre>
        </li>

        <li>Download <a href="/assets/tutorial/code/PetStore/ConfigureSvcs.cs" download>ConfigureSvcs.cs</a> and place it into 
                the PetStore project folder.</li>

        <li>Edit the WebApi project to use ConfigureSvcs.cs.
            <ul>Edit PetStore\Startup.cs and replace it's content with the following:
                Note line number 29 - which we add to the standard startup to "hook" in service registrations
                generated by LazyStack.
                <pre class="line-numbers"><code class="language-csharp">using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace PetStore
{
    public partial class Startup
    {

        public Startup(IConfiguration configuration)
        {
            Configuration = configuration;
        }

        public IConfiguration Configuration { get; }


        // This method gets called by the runtime. Use this method to add services to the container.
        // For more information on how to configure your application, visit https://go.microsoft.com/fwlink/?LinkID=398940
        public void ConfigureServices(IServiceCollection services)
        {
            ConfigureSvcs(services);
            services.AddControllers();
            services.AddSwaggerGen(c =>
            {
                c.SwaggerDoc("v1", new Microsoft.OpenApi.Models.OpenApiInfo { Title = "PetStoreAPI", Version = "v1" });
            });
        }

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }

            app.UseRouting();

            app.UseEndpoints(endpoints =>
            {
                endpoints.MapControllers();
            });

            app.UseSwagger();
            app.UseSwaggerUI(c =>
            {
                c.SwaggerEndpoint("/swagger/v1/swagger.json", "PetStore V1");
            });

            app.Run(async (context) => await Task.Run(() => context.Response.Redirect("/swagger")));

        }
    }
}
</code></pre>
        <li>Delete the PetStore project Controllers folder.</li>
        <li>Delete the WeatherForecast.cs file.</li>
        <li>Select Visual Studio menuitem Build &RightArrow; Rebuild All. The solution compiles successfully.</li>
    </ol>
   
    <h4>2.2 Add External LazyStack Projects</h4>
    <ol>
        <li>Add External LazyStackAuth project
            <ol type="a">
             <li>Right Click on the 'PetStore' solution, top of the screen, in the Solution Explorer pane. The context menu appears. </li>
             <li>Select "Add &rightarrow; Exiting Project ..". The Add Exiting Project dialog appears.</li>
             <li>Select LazyStackTutorial\LazyStack\LazyStackAuth\LazyStackAuth.csproj. The project is added to your solution.</li>
            </ol>
        </li>
        <li>Add External LazyStackDynamoDBRepo project
         <ol type="a">
          <li>Right Click on "Solution 'PetStore' in the Solution Explorer pane. The context menu appears." </li>
          <li>Select "Add &rightarrow; Exiting Project ..". The Add Exiting Project dialog appears.</li>
          <li>Select LazyStackTutorial\LazyStack\LazyStackDynamoDBRepo\LazyStackDynamoDBRepo.csproj. The project is added to your solution.</li>
         </ol>
     </li>
    </ol>
    <p>Note: In a production application you may choose to use the corresponding NuGet packages instead of using 
        these projects directly. In this tutorial it is useful to be able to debug into these projects to understand 
        how their features are implemented.
    </p>    

    <h4>2.3 Download PetStore.yaml and run LazyStack Generator</h4>
    <ol>
        <li><a href="/assets/tutorial/PetStore.yaml" download="PetStore.yaml">Click to Download PetStore.yaml file</a></li>
        <li>Move PetStore.yaml from your Downloads folder to the PetStore Solution root folder.</li>
        <li>Select Visual Studio  "Tools &rightarrow; LazyStack - Generate Projects". The following folders and projects are
            are created.
            <ul>
                <li>Controllers folder
                    <ul>
                        <li>OrderController project</li>
                        <li>PetController project</li>
                    </ul>
                </li>
                <li>Lambdas folder
                    <ul>
                        <li>Order project</li>
                        <li>Pet project</li>
                    </ul>
                </li>
                <li>"Solution Items" folder (files are in the solution's root folder)
                    <ul>

                        <li>LazyStack.yaml</li>
                        <li>LocalApis.json</li>
                        <li>PetStore.yaml</li>
                        <li>SAM_Review.yaml</li>
                    </ul>
                </li>
                <li>Stacks folder
                    <ul>
                        <li>Dev folder
                            <ul>
                                <li>serverless.template</li>
                            </ul>
                        </li>
                        <li>Test folder
                            <ul>
                                <li>serverless.template</li>
                            </ul>
                        </li>
                        <li>Prod folder
                            <ul>
                                <li>serverless.template</li>
                            </ul>
                        </li>

                    </ul>
                    </li>
                <li>PetStoreClientSDK project</li>
                <li>PetStoreSchema project</li>
            </ul>
        </li>
        <li>Add files in solution directory to Solution Items folder
            <ol>
                <li>Right Click "PetStore" solution in solution explorer. The context menu appears.</li>
                <li>Select Add &rightarrow; Existing Files. The file picker dialog appears.</li>
                <li>In the PetStore solution directory, select newly added files:
                    <ul>
                        <li>Petstore.yaml</li>
                        <li>LazyStack.yaml</li>
                        <li>LocalApis.json</li>
                        <li>SAM_Review.yaml</li>
                    </ul>
                </li>
                
                <li>Click the Open button. A new solution explorer "Solution Items" folder is created containing the 
                    selected files.</li>
            </ol>
        <li>Add the serverless.template file and solution folders
            <ol>
                <li>Right Click "PetStore" solution in the solution explorer. The context menu appears.</li>
                <li>Select "Add &rightarrow; Solution Folder". A folder called "New Folder" is inserted into the 
                    solution explorer.</li>
                <li>Edit the name of folder to "Stacks".</li>
                <li>Right Click on the "Stacks" folder. The context menu appears.</li>
                <li>Select "Add &rightarrow; Solution folder". A new folder called "New Folder" is inserted under the 
                    Stacks folder.</li>
                <li>Edit the name of the folder to "Dev"</li>
                <li>Right Click on the "Dev" folder. The context menu appears.</li>
                <li>Select "Add &rightarrow; Existing Files. The file picker window appears,.</li>
                <li>Select the "LazyStackTutorial/PetStore/Stacks/Dev/serverless.template" file.</li>
            </ol>
        </li>
    </ol>
<p></p>
<h4>2.4 Review the LazyStack.yaml file</h4>
    <p>The Generate Projects command created a default LazyStack.yaml file in your solution's root 
        folder. The file is now visible in the "Solution Items" folder in the solution explorer.
        The top of the LazyStack.yaml file should look like this:
    </p>
    <pre><code class="language-yaml">
LazyStackDirectivesVersion: 1.1.0
Stacks:
  Dev:
    ProfileName: default
    RegionName: us-east-1
    StackName: PetStoreDev 
    Stage: Dev
    UriCodeTarget: Debug/net6.0
  Test:
    Stage: Test
    UriCodeTarget: Release/net6.0
  Prod:
    Stage: Prod
    UriCodeTarget: Release/net6.0
ProjectOptions: 
  NugetPackageVersions:
    Amazon.Lambda.AspNetCoreServer: 7.1.0
    AWSSDK.Extensions.NETCore.Setup: 3.7.2
    JsonSubTypes: 1.8.0
    LazyStackAuth: 1.4.0
    Newtonsoft.Json: 13.0.1
    Swashbuckle.AspNetCore: 6.2.3
    System.ComponentModel.Annotations: 5.0.0
    System.IdentityModel.Tokens.Jwt: 6.14.1
  ClientSDKProjects:
    PackageReferences:
      LazyStackAuth: ''
      System.ComponentModel.Annotations: ''
      JsonSubTypes: ''
      Newtonsoft.Json: ''
  SchemaProjects:
    PackageReferences:
      Newtonsoft.Json: ''
  LambdaProjects:
    Runtime: dotnet6
    PackageReferences:
      AWSSDK.Extensions.NETCore.Setup: ''
      Amazon.Lambda.AspNetCoreServer: ''
  WebApiProjects:
    PackageReferences:
      AWSSDK.Extensions.NETCore.Setup: ''
      Swashbuckle.AspNetCore: ''
  ControllerProjects:
    PackageReferences:
      System.IdentityModel.Tokens.Jwt: ''</code></pre>

<h4>2.5 Review the SAM_Review.yaml</h4>
<p>The SAM_Review.yaml file was generated in the solution folder. This file contains the stack configuration 
    without stack environment specific content inserted. Stack environments might include Dev, Test and Prod. Fully 
    constituted templates are placed in the serverless.template files placed in the stack environment folder. 
    For instance, the Stacks\Dev\serverless.template file is the template you will later use to publish the PetStoreDev 
    stack to AWS. 
    </p>
<p>You never edit the SAM_Review.yaml file directly.</p>
<ol>
    <li>Open the Solution Items\SAM_Review.yaml file.</li>
    <li>Review contents. No need to understand all this content now.</li>
</ol>
<p>The SAM_Review.yaml file will be updated with new content as we add and configure AWS stack resources during the tutorial.
    This file is regenerated each time you execute LazyStack -- Generate Projects.
</p>

<h4>2.6 Review serverless.template file</h4>
<p> LazyStack Generate Projects process generates one serverless.template file for each environment. In this case, 
    we are using the Stacks Environment called "Dev" and the serverless.template file generated in the 
    Stacks\Dev folder. 
</p>
<p>You want to review the SAM template we will later publish to AWS. You never edit this file directly.</p>
<ol>
    <li>Open the Stacks\Dev\serverless.template file.</li>
    <li>Review contents. No need to understand all this content now.</li>
</ol>
<p>The serverless.template file will be updated with new content as we add and configure AWS stack resources during the tutorial.
    This file is regenerated each time you execute LazyStack -- Generate Projects.
</p>

<h4>Step Summary</h4>
<p>In this lesson step we created a PetStore solution using the ASP.NET API project template, 
    downloaded a OpenApi Specification called PetStore.yaml and then used the Tools &RightArrow; LazyStack - 
    Generate Projects to generate projects and configuration files for our stack. We added solution folders to 
    surface these configuration files in the Visual Studio solution explorer. 
    We then updated the LazyStack.yaml file AWS ProfileName and RegionName.
</p>
{{>btmspacer}}
</div>