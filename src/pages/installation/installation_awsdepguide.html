---
layout: docpage
section: Install
topic: GettingStarted
install: smf
---
{{> installation_menu}}
<div class="lz-r-content manual-list">
    <h3>LazyStack AWS SMF Deployment Summary</h4>
        <p>Here is a technical overview of the SMF deployment. Review this overview to get an idea of what the install
            will do and what resources and skills you need to perform the install.
        </p>
        <ul>
            <li>1. Technical Skills and Knowledge
                <ul>
                    <li>Some basic experience installing software on a workstation</li>
                    <li>Experience running scripts in a command terminal/window</li>
                    <li>Experience editing text files</li>
                    <li>We recommend having reviewed AWS Getting Started Guides</li>
                </ul>
            </li>
            <br>            
            <li>2. Use Cases:
                <ul>
                    <li>2.1 Use Case: Install SMF<br>
                        
                        <ul>Prerequisites:
                            <li>
                                <ul>
                                    <li>- Workstation running an OS supporting PowerShell, .NET, AWS CLI, and AWS SAM CLI (ex: Windows 10, Linux, MacOS)</li>
                                    <li>- Administrative workstation access to install and run software</li>
                                    <li>- Credit card for creating AWS Management Account</li>
                                    <li>- Unique email addresses (or aliases) for each AWS Account being created</li>
                                    <li>- GitHub Repo (for steps 3 and 4)</li>
                                </ul>
                            </li>
                        </ul>
                        <br>
                        <ul>Time To Complete
                            <li>
                                <ul>
                                    <li>- SMF Step 1 - 10 minutes</li>
                                    <li>- SMF Step 2 - 2 minutes</li>
                                    <li>- SMF Step 3 - 2 minutes (optional)</li>
                                    <li>- SMF Step 4 - 2 minutes (optional)</li>
                                </ul>
                            </li>
                        </ul>
                        <br>
                        <ul>Costs - None</ul>
                        <br>
                        <ul> These actions are performed on the Management Workstation
                            and/or AWS Console. Much of the following configuration are are automated with PowerShell
                            scripts.
                            <li>SMF Step 1- Create AWS Organization
                                <ul>
                                    <li>SMF 1.1 Configure Management Workstation
                                        <ul>
                                            <li>Install PowerShell</li>
                                            <li>Install Git client</li>
                                        </ul>
                                    </li>
                                    <li>SMF 1.2 Create AWS Management Account
                                        <ul>
                                            <li>Sign up for AWS Account</li>
                                            <li>Create IAM User - OrgMgmt</li>
                                            <li>Install AWS CLI</li>
                                            <li>Create Named AWS Profile - OrgMgmt</li>
                                            <li>Install AWS SAM CLI</li>
                                        </ul>
                                    </li> 
                                    <li>SMF 1.3 Create AWS Organization<br>
                                        <ul>
                                            <li>Run Org_Create.ps1 to:
                                                <ul>
                                                    <li>Create Organizational Unit - OrgDevOU</li>
                                                    <li>Create Organizational Unit - OrgTestOU</li>
                                                    <li>Create Organizational Unit - OrgProdOU</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>SMF 1.4 Create GitHub Account</li>
                                </ul>
                            </li>
                            <br>
                            <li>SMF Step 2 - Add Developers
                                <ul>
                                    <li>SMF 2.1 - Create Developer Account<br>
                                        <ul>
                                            <li>Run Dev_Account_Create.ps1 script to:
                                                <ul>
                                                    <li>Create AWS developer account - ex: OrgDevJoe</li>
                                                    <li>Move developer account into the Dev Organizational Unit</li>
                                                    <li>Create IAM User for the developer</li>
                                                    <li>Create Developers IAM Group having PowerUser and limited IAM permissions</li>
                                                    <li>Assign IAM User to IAM Group</li>
                                                    <li>Create named role profile - OrgDevJoeAccess<br>
                                                        OrganizationalAccountAccessRole policy allows Management account
                                                        to administer the developer's Account.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>SMF 2.2 - Configure Developer's Workstation</li>
        
                                </ul>

                            </li>
                            <br>
                            <li>SMF Step 3 - Create System
                                <ul>
                                    <li>SMF 3.1 - Create System Test Account<br>
                                        <ul>
                                            <li>Run Test_Account_Create.ps1 script to:
                                                <ul>
                                                    <li>Create a System Test Account - OrgSysTest</li>
                                                    <li>Move it under the Test Organizational Unit - OrgTestOU</li>
                                                    <li>Create the Test Account IAM User</li>
                                                    <li>Create the Administrators group</li>
                                                    <li>Assign the IAM User to the Administrators group</li>
                                                    <li>Create a Management Workstation AWS profile with
                                                        OrganizationalAccountAccessRole policy to allow Management account
                                                        to administer the Test Account.
                                                    </li>
                                                </ul>
                                            </li>
                                            <li>SMF Step 3.2 - Create System Production Account<br>
                                                <ul>
                                                    <li>Run Prod_Account_Create.ps1 script to:
                                                        <ul>
                                                            <li>Create a System Prod Account - OrgSysProd</li>
                                                            <li>Move it under the Prod Organizational Unit - OrgProdOU</li>
                                                            <li>Create the Prod Account IAM User</li>
                                                            <li>Create the Administrators group</li>
                                                            <li>Assign the IAM User to the Administrators group</li>
                                                            <li>Create a Management Workstation AWS profile with
                                                                OrganizationalAccountAccessRole policy to allow Management account
                                                                to administer the Production Account.
                                                            </li>
                                                        </ul>
                                                    </li>

                                                </ul>
                                            </li>
                
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <br>
                            <li>SMF Step 4 - Create Stack
                                <ul>
                                    <li> SMF 4.1 - Create GitHub Repository for serverless stack</li>
                                    <li>Step 4.2 - Setup Continuous Integration and Continuous Deployment for Test Account Stack
                                        <ul>
                                            <li>Create a CodeBuild GitHub Connection for the Test Account</li>
                                            <li>Run Test_CodeBuild_Deploy.ps1 to:
                                                <ul>
                                                    <li>Install a CodeBuild project that builds, tests and publishes a Pull Request (PR) stack when a PR is created or updated.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>

                                    <li>Step 4.3 - Setup Continuous Deployment for System Production Account Stack
                                        <ul>
                                            <li>Create a CodeBuild GitHub Connection for the Production Account</li>
                                            <li>Run Prod_CodeBuild_Deploy.ps1 to:
                                                <ul>
                                                    <li>Create a CodeBuild Connection among Production Account and GitHub</li>
                                                    <li>Install a CodeBuild project that builds, tests and publishes a Pull Request (PR) stack when a PR is created or updated.</li>
                                                    <li>Install a CodeBuild project that deletes a PR stack when the PR is closed.</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>

                                </ul>
                            </li>
                        </ul>
                    </li>
                    <br>
                    <li>2.2 Use Case: Developer Publishes a Stack to their Development Account<br>
                        <ul>Prerequisites:
                            <li>
                                <ul>
                                    <li>- Development Workstation Configuration Complete</li>
                                </ul>
                            </li>
                        </ul>
                        <ul>
                            <li>Publish stack using AWS Toolkit Extension for Visual Studio IDE (Windows)</li>
                            <li>Publish stack using AWS SAM CLI</li>
                        </ul>
                    </li>
                    <br>
                    <li>2.3 Use Case: Developer Creates GitHub Pull Request
                        <ul>Prerequisites:
                            <li>
                                <ul>
                                    <li>- SMF Step 3 Complete</li>
                                </ul>
                            </li>
                        </ul>
                        <ul>
                            <li>Test Account CodeBuild Project publishes stack for PR</li>
                        </ul>
                    </li>
                    <br>
                    <li>2.4 Use Case: Developer Updates GitHub Pull Request
                        <ul>Prerequisites:
                            <li>
                                <ul>
                                    <li>- SMF Step 3 Complete</li>
                                </ul>
                            </li>
                        </ul>
                        <ul>
                            <li>Test Account CodeBuild Project updates stack for PR</li>
                        </ul>
                    </li>
                    <br>
                    <li>2.5 Use Case: GitHub Pull Request is merged
                        <ul>Prerequisites:
                            <li>
                                <ul>
                                    <li>- SMF Step 3 Complete</li>
                                    <li>- SMF Step 4 Complete (required only for Production Account Update)</li>
                                </ul>
                            </li>
                        </ul>
                        <ul>
                            <li>Test Account CodeBuild Project deletes stack for PR</li>
                            <li>Prod Account CodeBuild Project creates/updates Production stack</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <br>
            <li>3. Typical Customer Deployment AWS Resources
                <ul>
                    <li>AWS Organization
                        <ul>
                            <li>Management Account - OrgMgmt
                                <ul>
                                    <li>Member of IAM User Group - Administrators</li>
                                    <ul>
                                        <li>AWS Policy AdministratorAccess</li>
                                    </ul>
                                    <li>IAM User - OrgMgmt
                                        <li>Member of Administrators User Group</li>
                                    </li>
                                </ul>
                            </li>
                            <li>Development Organizational Unit - OrgDevOU
                                <ul>
                                    <li>Developer account(s) - ex: OrgDevJoe
                                        
                                        <ul>
                                            <li>Customer Policy IAMUserCredsPolicy (see IAMUserCredsPolicy.json)
                                                <ul>
                                                    <li>AllowViewAccountInfo</li>
                                                    <li>AllowManageOwnPasswords</li>
                                                    <li>AllowManageOwnAccessKeys</li>
                                                    <li>AllowManageOwnSSHPublicKeys</li>
                                                </ul>
                                            </li>
                                            <li>IAM User Group Developers
                                                <ul>
                                                    <li>AWS Policy PowerUserAccess</li>
                                                    <li>Customer Policy IAMUserCredsPolicy</li>
                                                </ul>
                                            </li>
                                            <li>IAM User - OrgDevJoe
                                                <ul>
                                                    <li>Member of Developers User Group</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>Test Organizational Unit - OrgTestOU
                                <ul>
                                    <li>System Test Account - OrgSysTest
                                        <ul>
                                            <li>Administrators User Group
                                                <ul>
                                                    <li>AWS Policy AdministratorAccess</li>
                                                </ul>
                                            </li>
                                            <li>IAM User - OrgSysTest
                                                <ul>
                                                    <li>Member of Administrators User Group</li>
                                                </ul>
                                            </li>
                                            <li>CodeBuild Connection to GitHub repository</li>
                                            <li>Test_CodeBuild_PR_Create.yaml template - CodeBuild Project to Create/Update test stack for a new/updated Pull Request
                                                <ul>CodeBuild Project Stack Resources:
                                                    <li>AWS::S3::Bucket - build artifacts1</li>
                                                    <li>AWS::CodeBuild::Project
                                                        <ul>
                                                            <li>Webhook on PR Create/Update</li>
                                                            <li>Inline Script for Build, Test, and Deploy
                                                                <pre><code class="language-bashshell"># csh script                                                                    
# stack names can not include / characters so we replace with -
- stack=$(echo $CODEBUILD_WEBHOOK_TRIGGER | sed 's/\//-/g')
- dotnet build --configuration Release
# dotnet test
# ${S3} is replaced during cloudformation template processing with S3 name
# $stack is replaced by csh
- eval "sam deploy -t Stacks/Rev/serverless.template --stack-name $stack --s3-bucket ${S3} --capabilities CAPABILITY_NAMED_IAM --region ${AWS::Region}"</code></pre>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li>AWS::IAM::Role - CodeBuildRole</li>
                                                    <li>AWS::IAM::Policy - CodeBuildPolicy</li>
                                                </ul>
                                            </li>
                                            <li>Test_CodeBuild_PR_Merge.yaml template - Codebuild Project stack to Delete test stack for for a merged Pull Request
                                                <ul>CodeBuild Project Stack Resources:
                                                    <li>AWS::S3::Bucket - build artifacts1</li>
                                                    <li>AWS::CodeBuild::Project
                                                        <ul>
                                                            <li>Webhook on PR Merge</li>
                                                            <li>Inline Script for delete stack
                                                                <pre><code class="language-bashshell"># csh script                                                                    
# stack names can not include / characters so we replace with -
- stack=$(echo $CODEBUILD_WEBHOOK_TRIGGER | sed 's/\//-/g')
- dotnet build --configuration Release
# ${S3} is replaced during cloudformation template processing with S3 name
# $stack is replaced by csh
- eval "aws cloudformation delete-stack --stack-name $stack"</code></pre>                                                                
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li>AWS::IAM::Role - CodeBuildRole</li>
                                                    <li>AWS::IAM::Policy - CodeBuildPolicy</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>Prod Organizational Unit - OrgProdOU
                                <ul>
                                    <li>System Production Account - OrgSysProd
                                        <ul>
                                            <li>Administrators User Group
                                                <ul>
                                                    <li>AWS Policy AdministratorAccess</li>
                                                </ul>
                                            </li>
                                            <li>IAM User - OrgSysProd
                                                <ul>
                                                    <li>Member of Administrators User Group</li>
                                                </ul>
                                            </li>
                                            <li>CodeBuild Connection to GitHub repository</li>
                                            <li>Prod_CodeBuild_PR_Merge.yaml template - CodeBuild Project Stack to Create/Update Prod stack for a merged Pull Request
                                                <ul>CodeBuild Project Stack Resources:
                                                    <li>AWS::S3::Bucket - build artifacts1</li>
                                                    <li>AWS::CodeBuild::Project
                                                        <ul>
                                                            <li>Webhook on PR Merge</li>
                                                            <li>Inline Script for Build, and Deploy
<pre><code class="language-bashshell">#csh script
- dotnet build --configuration Release
- eval "sam deploy -t Stacks/Rev/serverless.template --stack-name prod --s3-bucket ${S3}  --capabilities CAPABILITY_NAMED_IAM --region ${AWS::Region}" </code></pre>                                                                
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li>AWS::IAM::Role - CodeBuildRole</li>
                                                    <li>AWS::IAM::Policy - CodeBuildPolicy</li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <br>
            <li>4. Deployment Naming
                <ul>
                    <li>OrgCode prefix to be used for organizational units and accounts</li>
                    <li>SysCode prefix to be used for system test and system production accounts</li>
                </ul>
            </li>
            <br>
            <li>5. Architectural Diagrams
                <ul>
                    <li>Software Management Framework Flow<br>
                        <img src="/assets/img/SDLCFeatureflowVSIDEOverview.svg">
                    </li>
                    <br>
                    <li>AWS Organization Overview<br>
                        <img src="/assets/img/LazyStackSMF2.svg">
                    </li>
                    <br>
                    <li>AWS CodeBuild and Cloud Formation Services<br>
                        <img src="/assets/img/AwsSetup2.svg">
                    </li>
                    <br>
                    <li>AWS Root and IAM Users with Management and Development workstation AWS Profiles<br>
                        <img src="/assets/img/AwsSetupUsers2.svg">
                    </li>
                    <br>
                    <li>CI/CD Stacks<br>
                        <img src="/assets/img/SDLCFeatureflowVSIDE.svg">
                    </li>
                </ul>
            </li>
            <br>
            <li>6. Security References
                <ul>
                    <li><a href="https://aws.amazon.com/security/security-learning">AWS Cloud Security</a></li>
                </ul>
            </li>
            <li>7. AWS Costs<br>
                All resources used in the SMF qualify for usage under the free tier
                <ul>
                    <li><a href="https://aws.amazon.com/pricing/">AWS Pricing Overview</a></li>
                </ul>
            </li>
            <li>8. AWS Sizing
                <ul>
                    <li>Since the SWF is a development tool. Sizing considerations are not relevant for small to medium sized teams.</li>
                </ul>
            </li>
        </ul>
</div>