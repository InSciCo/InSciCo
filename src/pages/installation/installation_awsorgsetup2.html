---
layout: docpage
section: Install
topic: GettingStarted
---
{{> installation_menu}}
<div class=lz-r-content>
    <h3>AWS Organization Setup Part 2 (optional)</h4>
        <dl>
            <dt>Prerequisites:</dt>
            <dd>- AWS Organization Setup Part 1 complete</dd>
             <dt>Estimated Time: ?? minutes</dt> 
            <dt>Estimated Cost: none</dt> 
        </dl>  

    <p>In Part 2 we configure a fully functional AWS Organization supporting 
        collaborative Serverless Stack development, publishing test stacks, and 
        publishing production stacks. </p>

        <h4>AWS Organizational Units and Member Accounts</h4>
            <p>
            In Part 1 we created an AWS Organization containing a OrgDevOU Organizational Unit. In 
            this Part we will create two new Organizational Units: OrgTestOU and OrgProdOU. We will also
            add an OrgTest and OrgProd account along with GitHub integration and a CI/CD implementation. 
            When complete, your AWS Organization will look something like this:</p>
            <img src="/assets/img/AwsSetup2.svg">  

        <p></p>

        <h5>Insight: </h5>
        <ul>
            <li>We prefix each account in our organization with a short "OrdCode" to make working 
                with multiple organizations less confusing.
            </li>
            <li>DynamoDB and S3 are provisioned in the account, not inside the serverless stack. 
                These services are shared for all stacks in that account. For instance, if you 
                have two stacks that both use DynamoDB, they should each use different tables
                to segregate their data.</li>
            <li>This environment uses AWS CodeBuild projects integrated with GitHub webhooks to
                publish stacks to the Test Account or Production Account when a Pull Request is processed. 
                <ul>
                    <li>Test Account CodeBuild Project(s)
                        <ul>
                            <li>Opening Pull Request (PR) automatically publishes a test stack named after the PR.</li>
                            <li>Closing Pull Request automatically deletes the test stack.</li>
                            <li>There can be multiple test stacks.</li>
                        </ul>
                    </li>
                    <li>Prod Account CodeBuild Project
                        <ul>
                            <li>Merging a Pull Request publishes the production stack.</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>This CI/CD setup does not require or provide per developer CI/CD 
                pipelines. However, you can easily implement these pipelines using techniques 
                illustrated by the CI/CD CodeBuild projects in the Test and Production accounts. 
                We do not recommend this as the developer may publish their own sandbox stacks 
                more quickly from their desktop. They may also run stack tests locally and against 
                their sandbox stacks.
            </li>
            <li>There are a multitude of different tools and workflow patterns for CI/CD. If 
                you are new to CI/CD, this setup will provide enough understanding to to 
                evaluate other CI/CD solutions if this example solution falls short of 
                your requirements.
            </li>
            <li>There are many Git repository services that you can use instead of GitHub. GitHub 
                was selected only because it is so widely used by the .NET community. Some other 
                popular Git repositories include BitBucket, GitLab and AWS CodeCommit. 
            </li>
        </li>
    
        </ul> 

<h4>AWS Users and AWS CLI Profiles</h4>
<p>Each Account has a Root User and one or more IAM Users. Root users sign into an account 
    using their email address and password. IAM Users sign into the account using the 
    AccountID, and their UserName and Password. You can, and should, add MFA to Root User access and 
    IAM User access.
</p>
<p>The AWS CLI allows programmatic access to Accounts using credentials stored in "profiles" 
    on your workstation. Since an organization has multiple accounts, we use "named" profiles 
    when issuing AWS CLI commands to ensure we always update the correct account. 
    The AWS CLI allows the creation of a "default" profile. We recommend that this be used 
    with care on a workstation with access to multiple accounts; we recommend that the 
    AWS Organization Management Account credentials are NOT be stored in the 
    AWS CLI "default" profile.
</p>
<p>When complete, your organization's AWS Root Users and IAM Users will look something 
    like this:</p>
<img src="/assets/img/AwsSetupUsers2.svg">
<p></p>
<h5>Insights:</h5>
<ul>
    <li>Root User access to the Management Account is infrequent and largely relegated to actions one 
        would take in the AWS Console.
    </li>
    <li>We only create AWS CLI Profiles for IAM Users.</li>    
    <li>Root User access to Member Accounts is very-rarely necessary and these login-credentials should not be shared.</li>
    <li>The IAM User OrgMgmt can assume the OrganizationAccountAccessRole to administer Member Accounts. For example,
        the AWS CLI Profiles OrgDevJoeAccess, OrgTestAccess, and OrgProdAccess are used to administer the 
        corresponding Member Accounts from the OrgMgmt Management Account when using the AWS CLI.
    </li>
    <li>Root Users sign-in with at least an email address and password. An email address can be used
        with only one AWS account. Use email address aliases to be a root user in different AWS accounts.
    </li>
</ul>        

</div>