<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta property='og:title' content='LazyStack.io' />
    <meta property='og:image' content='https://lazystack.io/assets/img/ThreeGreatTechnologies.png' />
    <meta property='og:description'
        content='LazyStack is a tool that ingests an OpenApi (swagger) REST API specification and generates the AWS Server Application Model (SAM) template and the C# AWS Lambda projects necessary to stand up a fully featured commercial-grade application stack in AWS. It also generates a client application SDK making it simple to call that stack from C# applications.' />
    <meta property='og:url' content='https://lazystack.io' />

    <title>LazyStack</title>
    <link rel="stylesheet" href="/assets/css/app.css">
    <link href="/assets/prism/prism.css" rel="stylesheet" />
    <link href="/assets/prism/prismoverride.css" rel="stylesheet" />
    <link href="/assets/theme/lessons.css" rel="stylesheet" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var prevPage = "";
        var nextPage = "";
        var curPageFound = false;
        function loadMenuPageList() {
            var menupages = document.getElementsByClassName("menupage");
            for (var i = 0; i < menupages.length; i++) {
                var page = menupages[i].getElementsByTagName('a')[0].href;
                if (page != "") {
                    if (curPageFound) {
                        nextPage = page;
                        break;
                    }
                    // check if current page found
                    if (page == document.location.href) {
                        curPageFound = true;
                    } else {
                        prevPage = page;
                    }
                }
            }
        }
        function gotoPrevPage() {
            if (prevPage != "") {
                window.location.href = prevPage;
            }
        }
        function gotoNextPage() {
            if (nextPage != "") {
                window.location.href = nextPage;
            }
        }

    </script>
    <script>
        function scrollToTop() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera            
        }
    </script>

</head>

<body >
    <div class="grid-container medium-grid-frame "
        data-sticky 
        data-options="marginTop:0; stickyOn: small" 
        style="background-image: url('/assets/img/pic14.jpg');
            height: 70px;
            width: 1200px;
            "
            
        >
        <div class="grid-x grid-margin-x">
            <div class="cell small-1" 
                data-responsive-toggle="docmenu" 
                data-hide-for="medium"
                style="
                padding: 10px 0px 0px 0px; "
                >
                <button class="menu-icon" type="button" data-toggle onclick="scrollToTop()"></button>
            </div>
            <div  class="cell auto ">
                <div
                    style="
                    border: .125rem solid;
                    border-radius: 13px;
                    background-color: rgba(0, 0, 0, .40);
                    width: auto;
                    padding: 2px 10px 7px 10px;
                    margin: 10px;
                    width:235px
                    ">
                    <span style=
                        "font-size: 28px;
                        font-family: 'Arial Black', 'Arial Bold', Gadget, sans-serif;
                        color: rgba(180, 23, 186, 1);
                        ">
                        <img src="/assets/img/lazyface.png" style="max-height: 40px; margin-top: -5px;"/>  
                        <span style="margin-left: -5px;">LazyStack</span>
                    </span>
                </div>
            </div>            
            <div class="cell shrink" style="padding: 5px 0px 0px 0px;">
                <img 
                    src="/assets/img/NavLeft.svg" 
                    style="object-fit: scale-down;
                    height: 50px;
                    width: 38px;
                    padding: 10px 0px 0px 0px;
                    " 
                    onClick="gotoPrevPage()"
                />
                <img 
                    src="/assets/img/NavRight.svg" 
                    style="object-fit: scale-down;
                    height: 50px;
                    width: 38px;
                    padding: 10px 0px 0px 0px;
                    " 
                    onClick="gotoNextPage()"
                />

            </div>
        </div>

    </div>

    <div class="grid-container medium-grid-frame">
        <div class="grid-x grid-margin-x">
            <div class="cell medium-3 " style="padding: 10px 10px 10px 10px;">
                <!--
                <div class="title-bar lz-r-topicmenu hamburger" data-responsive-toggle="topics-collapse" data-hide-for="medium">
                    <button class="menu-icon" type="button" data-toggle></button>
                    <div class="title-bar-title"></div>
                </div>
                -->
                <!--
                <div class="top-bar fast lz-r-topicmenu dropdown outer" id="topics-collapse" data-animate="slide-in-down slide-out-up" style="white-space: nowrap">
                -->
                <!--<div class="top-bar fast lz-r-topicmenu" id="topics-collapse"  style="white-space: nowrap">    -->
                <!--<ul class="lz-r-topicmenu vertical menu accordion-menu" id="topics-collapse" data-accordion-menu 
                    data-submenu-toggle="true">-->
                
                
                <ul class="vertical menu accordion-menu" id="docmenu" data-accordion-menu 
                    data-submenu-toggle="true">
                    <li><a href="/index.html">Home</a></li>
                    <li><a href="/intro/intro.html">Business Introduction</a>
                        <ul class="menu vertical nested ">
                            <li class=" menupage">
                                <a href="/intro/intro.html">Overview</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_smf.html">Collaborate</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_mdd.html">Accelerate</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_serverless.html">Scale</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_whylazystack.html">Why Choose LazyStack?</a>
                            </li>
                        </ul>
                    </li>
                    <li><a href="/intro/intro_techoverview.html">Technical Introduction</a>
                        <ul class="menu vertical nested ">
                            <li class=" menupage"><a
                                    href="/intro/intro_techoverview.html">Overview</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_techoverviewsmf.html">Software Mgmt. Framework</a> 
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_techoverviewtools.html">MDD Developer Tools</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_security.html">Security First</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_whynet.html">Why .NET?</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_whyaws.html">Why AWS?</a>
                            </li>
                            <li class=" menupage">
                                <a href="/intro/intro_dynamodb.html">Why DynamoDB?</a>
                            </li>
                        </ul>
                    </li>
                
                    <li><a href="/installation/installation_overview.html">Installation</a>
                        <ul class="menu vertical nested ">
                            <li class=" menupage">
                                <a href="/installation/installation_overview.html">Overview</a>
                            </li>
                            <li><a href="/installation/smf_overview.html">Configure SMF</a>
                                <ul class="menu vertical nested ">
                                    <li class=" menupage">
                                        <a href="/installation/smf_overview.html">Overview </a>                                                   
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_create_org_checklist.html">Preparation Checklist</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_create_github_acct.html">1) Create GitHub Account</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_config_mgmt_workstation.html">2) Configure Workstation</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_create_mgmt_acct.html">3) AWS Mgmt. Account</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_create_org.html">4) Create AWS Org</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/smf_create_dev_acct.html">5) Create Dev Account(s)</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/installation_awsdepguide.html">Deployment Summary</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="/installation/devtools_config_dev_ws.html">Configure Dev Workstation</a>
                                <ul class="menu vertical nested ">
                                    <li class=" menupage">
                                        <a href="/installation/devtools_config_dev_ws.html">Overview</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/devtools_config_dev_profile.html">1) Configure Workstation</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/devtools_netcore_cli.html">2) .NET CLI Tool</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/devtools_visualstudio.html">3) VS IDE Windows</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/installation/devtools_visualstudio_mac.html">4) VS IDE MacOS</a>
                                    </li>
                                </ul>
                            
                            </li>
                        </ul>
                    </li>
                
                    <li><a href="/tutorial/tutorial_intro.html">Tutorials</a>
                        <ul class="menu vertical nested ">
                            <li class=" menupage">
                                <a href="/tutorial/tutorial_intro.html">Overview</a>
                            <li><a href="/tutorial/tutorial_vswin_overview.html">Visual Studio Windows</a>
                                <ul class="menu vertical nested ">
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_overview.html">Overview</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_petstore.html">1)PetStore</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_controllers.html">2) Implement Controllers</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_configure.html">3) Configure LazyStack</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_publishtoaws.html">4)Publish to AWS</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_testlocalwebapi.html">5) Test Local WebAPI</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_petstoretest.html">6) PetStore Test</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_consoleapp.html">7) Console App</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_xamarinapp.html">8) Xamarin App</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vswin_blazorapp.html">9) Blazor App</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="/tutorial/tutorial_vsmac_overview.html">Visual Studio MacOS</a>
                                <ul class="menu vertical nested ">
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_overview.html">Overview</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_petstore.html">1)PetStore</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_controllers.html">2) Implement Controllers</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_configure.html">3) Configure LazyStack</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_publishtoaws.html">4)Publish to AWS</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_testlocalwebapi.html">5) Test Local WebAPI</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_petstoretest.html">6) PetStore Test</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_consoleapp.html">7) Console App</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_xamarinapp.html">8) Xamarin App</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_vsmac_blazorapp.html">9) Blazor App</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="/tutorial/tutorial_cli_overview.html">.NET CLI</a>
                                <ul class="menu vertical nested ">
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_overview.html">Overview</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_petstore.html">1)PetStore</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_controllers.html">2) Implement Controllers</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_configure.html">3) Configure LazyStack</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_publishtoaws.html">4)Publish to AWS</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_testlocalwebapi.html">5) Test Local WebAPI</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_petstoretest.html">6) PetStore Test</a>
                                    </li>
                                    <li class=" menupage">
                                        <a href="/tutorial/tutorial_cli_consoleapp.html">7) Console App</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                
                    <li><a href="/userguide/userguide_overview.html">UserGuide</a>
                        <ul class="menu vertical nested is-active">
                            <li class=" menupage">
                                <a href="/userguide/userguide_overview.html">Overview</a>
                            </li>
                            <li><a href="/userguide/smf_overview.html">Software Mgmt. Framework</a>
                                <ul  class="menu vertical nested ">
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_overview.html">Overview</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_devsandbox.html">Developer Sandbox</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_gitrepos.html">Git Repository Integration</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_devworkflow.html">Developer Workflow</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_namedprofiles.html">Named Profiles</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_lzconfigure.html">LzConfigure Script</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_lznewdevacct.html">LzNewDevAccount Script</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_lzupdatedevcreds.html">LzUpdateDevCreds Script</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/smf_lzdeploypipeline.html">LzDeployPipeline Script</a>
                                    </li>
                                </ul>
                
                
                            </li>
                            <li><a href="/userguide/generator_tools_overview.html">LazyStack MDD Tools</a>
                                <ul class="menu vertical nested ">
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_tools_overview.html">Overview</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_overview.html">Generate Projects</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_stacks.html">Stacks Directive</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_defaultapi.html">DefaultApi Directive</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_apitagmap.html">ApiTagMap Directive</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_awsresources.html">AwsResources Directive</a>
                                    </li>
                                    <li> <a href="/userguide/generator_projectoptions.html">Project Options Directive</a>
                                        <ul class="menu vertical nested ">
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_projectoptions.html">Overview</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_nugetpackageversions.html">NugetPackageVersions</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_packagereferences.html">PackageReferences</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_projectreferences.html">ProjectReferences</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_serviceregistrations.html">ServiceRegistrations</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_properties.html">Properties</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a href="/userguide/generator_runtime.html">Runtime</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_warningescapedcharacters.html">Warning Escaped Characters</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_mergepriority.html">Resource Merge Priority</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/userguide/generator_aws_settings.html">Generate AWS Settings</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="/stacks/stacks_overview.html">Serverless Stacks</a>
                                <ul class="menu vertical nested ">
                                    <li  class=" menupage">
                                        <a href="/stacks/stacks_overview.html">Overview</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/stacks_aws_serverless.html">AWS Serverless Stacks</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/stacks_lazystack_stacks.html">LazyStack MDD Generator</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/stacks_openapi.html">OpenAPI Specification</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/stacks_cognito.html">AWS Cognito</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/apigateway/apigateway_overview.html">Api Gateways</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/stacks/apigateway/apigateway_multiplegateways.html">Multiple Api Gateways</a>
                                    </li>
                
                                    <li><a href="/stacks/lambda/lambda_overview.html">Lambdas</a>
                                        <ul class="menu vertical nested ">
                                            <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_overview.html">Overview</a>
                                             </li>
                                             <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_function.html">Lambda Functions</a>
                                             </li>
                                             <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_controllers.html">Controllers</a>
                                             </li>
                                             <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_methods.html">Event Methods</a>
                                             </li>
                                             <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_debugging.html">Debugging</a>
                                             </li>
                                             <li  class=" menupage">
                                                <a href="/stacks/lambda/lambda_tests.html">Test Projects</a>
                                             </li>
                                        </ul>
                    
                                    </li>
                                </ul>
                            </li>
                            <li><a  href="/clientsdk/clientsdk_overview.html">Client SDK</a>
                                <ul class="menu vertical nested ">
                                    <li  class=" menupage">
                                        <a  href="/clientsdk/clientsdk_overview.html">Overview</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/clientsdk/clientsdk_clientsdk.html">ClientSDK Project</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/clientsdk/clientsdk_schema.html">Schema Project</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/clientsdk/clientsdk_awssettings.html">AwsSettings</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a href="/clientsdk/clientsdk_using.html">Using the ClientSDK</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a  href="/libraries/libraries_overview.html">Libraries</a>
                                <ul class="menu vertical nested is-active">
                                    <li  class=" menupage">
                                        <a  href="/libraries/libraries_overview.html">Overview</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/libraries/lazystackauth/lazystackauth_lazystackauth.html">LazyStackAuth</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/libraries/lazystackauth/lazystackauth_authmessages.html">AuthMessages</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/libraries/lazystackauth/lazystackauth_authprovider.html">AuthProvider</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/libraries/lazystackauth/lazystackauth_authprocess.html">AuthProcess</a>
                                    </li>
                                    <li  class="is-active menupage">
                                        <a  href="/libraries/lazystackauth/lazystackauth_lzhttpclient.html">LzHttpClient</a>
                                    </li>
                                    <li  class=" menupage">
                                        <a  href="/libraries/getawssettings/getawssettings_getawssettings.html">GetAwsSettings</a>
                                    </li>
                
                                    <li><a  href="/libraries/dynamodb/dynamodb_overview.html">DynamoDBRepo</a>
                                        <ul class="menu vertical nested ">
                                            <li  class=" menupage">
                                                <a  href="/libraries/dynamodb/dynamodb_overview.html">Overview</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a  href="/libraries/dynamodb/dynamodb_ermodel.html">PetStore ER Model</a>
                                            </li>
                                            <li  class=" menupage">
                                                <a  href="/libraries/dynamodb/dynamodb_intro.html">DynamoDB Intro</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="/roadmap/roadmap_overview.html">Product RoadMap</a>
                        <ul class="menu vertical nested ">
                            <li  class=" menupage">
                                <a href="/roadmap/roadmap_overview.html">Overview</a>
                            </li>
                            <li  class=" menupage">
                                <a  href="/roadmap/mdd_v0100.html">MDD v1.0.x</a>
                            </li>
                            <li  class=" menupage">
                                <a  href="/roadmap/smf_v0100.html">SMF v1.0.x</a>
                            </li>
                        </ul>
                    </li>
                
                    <li class=" menupage">
                        <a href="/contact/contact_contact.html">Contact Us</a>
                    </li>
                
                    <li class=" menupage">
                        <a href="/privacy.html">Privacy</a>
                    </li>
                
                </ul>
                <!--</div>-->            </div>
            <div class="cell small-12 medium-9" style="padding: 10px 10px 10px 10px;">

<div class=lz-r-content> 
<h4>LzHttpClient Class</h4>
<p>The LzHttpClient class is responsible for making signed and unsigned calls to AWS ApiGateways. 
    There are two types of signed HttpRequests used in LazyStack calls to AWS Gateways:</p> 
    <ul>
        <li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-controlling-access-to-apis.html"target="_blank" rel="noopener noreferrer">
        JWT token</a> - typically used by AWS::Serverless:HttpApi ApiGateways</li>
        <li><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-authenticating-requests.html"target="_blank" rel="noopener noreferrer">AWS Signature Version 4</a>
             - highly secure option for AWS::Serverless::Api ApiGateways 
            <p><i>LzHttpClient uses the very well engineered <a href="https://github.com/FantasticFiasco/aws-signature-version-4"target="_blank" rel="noopener noreferrer">
                AwsSignatureVersion4</a> library to sign these types of requests.</i></p></li>
    </ul>
</p>

<p>The AWS "special sauce" is isolated in the LzHttpClient. Let's examine the implementation of 
    LzHttpClient to answer the following questions:
</p>
<ul>
    <li>How does LzHttpClass know which ApiGateway to call?</li>
    <li>How does LzHttpClass know what security scheme to apply on the call?</li>
    <li>How do we configure LzHttpClass to call the local WebApi? (where WebApi was generated by LazyStack)</li>
</ul>
<p>First, take the time to read through the LzHttpClient class code.</p>
<pre class="line-numbers"><code class="language-csharp">using Microsoft.Extensions.Configuration;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Net.Http;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace LazyStackAuth
{
    public class LzHttpClient : ILzHttpClient
    {
        public LzHttpClient(
            IConfiguration appConfig,
            AuthProviderCognito authProvider,
            string localApiName = null) :
#if DEBUG
        this(appConfig, authProvider, new HttpClient(GetInsecureHandler()), localApiName)
        { }
#else
        this(appConfig, methodMap, authProvider, new HttpClient(), localApiName)
        { }
#endif

        public LzHttpClient(
            IConfiguration appConfig,
            AuthProviderCognito authProvider,
            HttpClient httpClient,
            string localApiName = null)
        {
            this.httpClient = httpClient;
            this.localApiName = localApiName;
            if (!string.IsNullOrEmpty(localApiName))
                this.localApi = appConfig.GetSection($"LocalApis:{localApiName}").Get&lt;LocalApi>();
            this.awsSettings = appConfig.GetSection("Aws").Get&lt;AwsSettings>();
            this.authProvider = authProvider;
            this.methodMap = appConfig.GetSection("MethodMap").GetChildren().ToDictionary(x => x.Key, x => x.Value);
        }

        readonly HttpClient httpClient;
        readonly AwsSettings awsSettings;
        readonly LocalApi localApi;
        readonly string localApiName = string.Empty;
        AuthProviderCognito authProvider;
        Dictionary&lt;string, string> methodMap;


        // Note: CallerMember is inserted as a literal by the compiler in the IL so there is no 
        // performance penalty for using it.
        public async Task&lt;HttpResponseMessage> SendAsync(
            HttpRequestMessage requestMessage,
            HttpCompletionOption httpCompletionOption,
            CancellationToken cancellationToken,
            [CallerMemberName] string callerMemberName = null)
        {

            if (!methodMap.TryGetValue(callerMemberName, out string apiGatewayName))
                throw new Exception($"Error: {callerMemberName} not found in AwsSettings MethodMap");

            if (!awsSettings.ApiGateways.TryGetValue(apiGatewayName, out AwsSettings.Api api))
                throw new Exception($"Error: {apiGatewayName} not found in AwsSettings ApiGateways dictionary");

            var securityLevel = api.SecurityLevel;

            if (!string.IsNullOrEmpty(localApiName))
            {
                var uriBuilder = new UriBuilder(localApi.Scheme, localApi.Host, localApi.Port);

                // Issue: the AspNetCore server rejects a query with the ? encoded as %3F 
                // so the following doesn't work 
                // uriBuilder.Path = requestMessage.RequestUri.ToString(); 
                // the assignment encodes path query as %3F instead of ?
                // Here we encode the path separately and then build a
                // a new Uri from the uriBuilder and the path.
                var path = requestMessage.RequestUri.ToString(); // Unencoded
                path = Uri.EscapeUriString(path); // Encoded properly
                requestMessage.RequestUri = new Uri(uriBuilder.Uri, path);
            }
            else
            {
                var awshost = $"{api.Id}.{api.Service}.{awsSettings.Region}.{api.Host}";

                var uriBuilder = (api.Port == 443)
                    ? new UriBuilder(api.Scheme, awshost)
                    : new UriBuilder(api.Scheme, awshost, api.Port);

                var path = (!string.IsNullOrEmpty(api.Stage))
                    ? "/" + api.Stage + "/" + requestMessage.RequestUri.ToString()
                    : requestMessage.RequestUri.ToString();

                // Issue: the AspNetCore server rejects a query with the ? encoded as %3F 
                // so the following doesn't work 
                // uriBuilder.Path = requestMessage.RequestUri.ToString(); 
                // the assignment encodes path query as %3F instead of ?
                // Here we encode the path separately and then build a
                // a new Uri from the uriBuilder and the path.
                path = Uri.EscapeUriString(path); // Encoded properly
                requestMessage.RequestUri = new Uri(uriBuilder.Uri, path);
            }

            Debug.WriteLine($"requestMessage.Path {requestMessage.RequestUri.ToString()}");
            try
            {
                HttpResponseMessage response = null;
                // Note: If the call is being made against a local host then that host
                // will by default not pay any attention to the authorization header attached by 
                // the JWT or AwsSignatureVersion4 cases below. We assign the Headers
                // anyway in case you want to implement handling these headers 
                // in your local host for testing or any other purpose.
                switch (securityLevel)
                {
                    case AwsSettings.SecurityLevel.None:
                        response = await httpClient.SendAsync(
                            requestMessage,
                            httpCompletionOption,
                            cancellationToken);
                        break;

                    case AwsSettings.SecurityLevel.JWT:
                        // Use JWT Token signing process
                        requestMessage.Headers.Add("Authorization", authProvider.CognitoUser.SessionTokens.IdToken);
                        response = await httpClient.SendAsync(
                            requestMessage,
                            httpCompletionOption,
                            cancellationToken);
                        break;

                    case AwsSettings.SecurityLevel.AwsSignatureVersion4:
                        // Use full request signing process
                        // Get Temporary ImmutableCredentials :  AccessKey, SecretKey, Token
                        // This will refresh immutable credentials if necessary
                        // Calling AwsSignatureVersion4 extension method -- this signs the request message
                        var iCreds = await authProvider.Credentials.GetCredentialsAsync();

                        response = await httpClient.SendAsync(
                            requestMessage,
                            httpCompletionOption,
                            cancellationToken,
                            awsSettings.Region,
                            api.Service,
                            iCreds);
                        break;
                }
                return response;

            }
            catch (Exception e)
            {
                Debug.WriteLine($"Error: {e.Message}");
            }

            return new HttpResponseMessage(System.Net.HttpStatusCode.BadRequest);

        }
#if DEBUG        
        //https://docs.microsoft.com/en-us/xamarin/cross-platform/deploy-test/connect-to-local-web-services
        //Attempting to invoke a local secure web service from an application running in the iOS simulator 
        //or Android emulator will result in a HttpRequestException being thrown, even when using the managed 
        //network stack on each platform.This is because the local HTTPS development certificate is self-signed, 
        //and self-signed certificates aren't trusted by iOS or Android.
        public static HttpClientHandler GetInsecureHandler()
        {
            var handler = new HttpClientHandler
            {
                ServerCertificateCustomValidationCallback = (message, cert, chain, errors) =>
                {
                    if (cert.Issuer.Equals("CN=localhost"))
                        return true;
                    return errors == System.Net.Security.SslPolicyErrors.None;
                }
            };
            return handler;
        }
#endif
        public void Dispose()
        {
            httpClient.Dispose();
        }
    }
}
</code></pre>
  
<p>Now, let's examine and discuss the LzHttpClient class constructor(s) arguments:</p>
<pre><code class="language-csharp">
    public LzHttpClient(
        IConfiguration appConfig,
        AuthProviderCognito authProvider,
        HttpClient httpClient,
        string localApiName = null)
    {
        this.httpClient = httpClient;
        this.localApiName = localApiName;
        if (!string.IsNullOrEmpty(localApiName))
            this.localApi = appConfig.GetSection($"LocalApis:{localApiName}").Get&lt;LocalApi>();
        this.awsSettings = appConfig.GetSection("Aws").Get&lt;AwsSettings>();
        this.authProvider = authProvider;
        this.methodMap = appConfig.GetSection("MethodMap").GetChildren().ToDictionary(x => x.Key, x => x.Value);
    }</code></pre>
<p>It's useful to see how an instance of LzHttpStack is created to establish some context. Consider 
    this snippet of code.
</p>

<h5>How does LzHttpClass know which ApiGateway to call?</h5>
<p>LzHttpClient reads the "MessageMap" section of appConfig to get the MessageMap dictionary where the 
    key is the ClientSDK method name and the value is the ApiGateway to call.
</p>

<h5>How does LzHttpClass know what security scheme to apply on the call?</h5>
<p>The LzHttpClass reads the "Aws" section in appConfig. The AwsSettings include connection and security information for 
    each ApiGateway used in the stack. See the <a href="/clientsdk/clientsdk_awssettings.html"target="_blank" rel="noopener noreferrer">AwsSettings</a> documentation 
    for details on this configuration.
</p>
<h5>How dow we configure LzHttpClass to call a the local WebApi?</h5>
<p>LzHttpClient reads the "LocalApis" section of appConfg to get the local WebApi project configuration instead of ApiGateways. 
    To enable that feature you pass the constructor the local api name in the localApiName parameter. By default, LazyStack configures two local 
    WebApi hosts:
</p>
<pre><code class="language-json">
{
    "LocalApis": {
        "Local": {
        "Scheme": "https",
        "Host": "localhost",
        "Port": 5001
        },
        "LocalAndroid": {
        "Scheme": "https",
        "Host": "10.0.2.2",
        "Port":  5001
        }
    }
}</code></pre>
<p>The LocalAndriod api is necessary when using the Andriod device emulator as the emulator includes a proxy on 
    port 10.0.2.2 that redirects traffic to localhost.
</p>
<p>In addition, both the iOS simulator and Android emulator require special handling for the https scheme 
    as explained in the Microsoft documentation 
    <a href="https://docs.microsoft.com/en-us/xamarin/cross-platform/deploy-test/connect-to-local-web-services"target="_blank" rel="noopener noreferrer">here</a>.
</p>
<p>
Attempting to invoke a local secure web service from an application running in the iOS simulator 
or Android emulator will result in a HttpRequestException being thrown, even when using the managed 
network stack on each platform.This is because the local HTTPS development certificate is self-signed, 
and self-signed certificates aren't trusted by iOS or Android. 
</p>
<p>LzHttpClient includes the GetInsecureHandler() method to avoid this exception when calling the local WebApi.</p>
<p></p>
</div>
            </div>
        </div>
    </div>
    
   
    
    <script src="/assets/js/app.js"></script>
    <script src="/assets/prism/prism.js"></script>
    <script>loadMenuPageList();</script>

</body>

</html>